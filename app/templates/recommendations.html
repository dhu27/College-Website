{% extends "base.html" %}
{% block title %}Recommendations{% endblock %}
{% block content %}

<div class="recommendations-container">
  <div class="recommendations-form">
    <h2 style="display: flex; align-items: center; gap: 0.5rem;">
      Recommendations
      <span class="help-icon" tabindex="0">&#9432;
        <span class="help-tooltip">
          Use this page to find colleges that match your preferences. Select one or more states, set your academic and personal priorities using the sliders, and optionally enter your test scores, GPA, or a maximum annual tuition. Click "Get Recommendations" to see your personalized college matches.
        </span>
      </span>
    </h2>
    <form method="post">
      <label>Select States:</label>
      <div id="states-checkbox-list" class="states-checkbox-list"></div>
      <script src="{{ url_for('static', filename='js/states-checkbox.js') }}"></script>

      <label for="sat">SAT Score:</label>
      <input name="sat" id="sat" type="number" min="400" max="1600" step="10" placeholder="SAT" />

      <label for="act">ACT Score:</label>
      <input name="act" id="act" type="number" min="1" max="36" step="1" placeholder="ACT" />

      <label for="gpa">GPA:</label>
      <input name="gpa" id="gpa" type="number" min="0" max="4" step="0.01" placeholder="GPA" />

      <label for="cost">Max Annual Tuition (USD):</label>
      <input name="cost" id="cost" type="number" min="0" step="1000" placeholder="e.g. 30000" />

      <div style="margin: 0.5rem 0 0.2rem 0;">
          <span style="font-size: 1.2rem; color: var(--neutral-700); font-weight: 500;">Weight Factors</span>
          <span class="help-icon" tabindex="0" style="font-size:1.1rem;">
            &#9432;
            <span class="help-tooltip">
              Use the sliders to indicate how important each factor is to you. Higher values mean greater importance in your recommendations.
            </span>
          </span>
      </div>

      <label for="academics">Academics:</label>
      <input type="range" name="academics" id="academics" min="0" max="1" step="0.01" value="0.9" oninput="academics_val.value = this.value">
      <output id="academics_val">0.9</output>


      <label for="professors">Professor Quality:</label>
      <input type="range" name="professors" id="professors" min="0" max="1" step="0.01" value="0.3" oninput="professors_val.value = this.value">
      <output id="professors_val">0.3</output>

      <label for="diversity">Diversity:</label>
      <input type="range" name="diversity" id="diversity" min="0" max="1" step="0.01" value="0.4" oninput="diversity_val.value = this.value">
      <output id="diversity_val">0.4</output>

      <label for="urbanicity">Large Metropolitan City:</label>
      <input type="range" name="urbanicity" id="urbanicity" min="0" max="1" step="0.01" value="0.2" oninput="urbanicity_val.value = this.value">
      <output id="urbanicity_val">0.2</output>

  <label for="prestige">Prestige:</label>
  <input type="range" name="prestige" id="prestige" min="0" max="1" step="0.01" value="0.2" oninput="prestige_val.value = this.value">
  <output id="prestige_val">0.2</output>

      <button type="submit">Get Recommendations</button>
    </form>
  </div>
  <div class="recommendations-results">
    <h2>Results</h2>
    {% if results is not defined or results|length == 0 %}
      <div class="welcome-message" style="margin:2rem 0; font-size:1.2rem; color:var(--neutral-700); text-align:center;">
        <strong>Welcome to the College Recommendations page!</strong><br>
        Use the form to the left to enter your preferences and click <b>Get Recommendations</b>.<br>
        Your personalized college matches will appear here.
      </div>
    {% else %}
      <ul>
        {% for r in results %}
          <li>
            <a href="{{ url_for('colleges.college_detail', college_id=r.id) }}" class="college-link">{{ r.INSTNM }}</a> ({{ r.CITY }}, {{ r.STABBR }}) â€” Score: {{ '%.2f'|format(r.score) }}
            <div class="add-to-list-btn-wrapper">
              <button class="add-to-list-btn" data-college-id="{{ r.id }}">Add to List</button>
              <div class="list-dropdown" data-college-id="{{ r.id }}">
                <form class="add-to-list-form">
                  <div class="dropdown-section-title">Your Lists</div>
                  <div class="user-lists-menu">
                    <ul class="user-lists">
                      {% for user_list in user_lists %}
                        <li>
                          <button type="button" class="add-to-list-option" data-list-id="{{ user_list.id }}" data-college-id="{{ r.id }}">
                            {{ user_list.name }}
                          </button>
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                  <input type="text" class="new-list-name" placeholder="New list name">
                  <div class="form-buttons">
                    <button type="button" class="create-list-btn">Create New List</button>
                    <button type="submit" class="add-to-list-submit">Add to List</button>
                  </div>
                </form>
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
</div>
<script src="{{ url_for('static', filename='js/add-to-list.js') }}"></script>
{% endblock %}